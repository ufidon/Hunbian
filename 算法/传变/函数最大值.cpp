#include <iostream>
#include <iomanip>
#include <string>
#include <sstream>
#include <vector>
#include <map>
#include <algorithm>
#include <iterator>
#include <functional>
#include <random>
#include <numeric>
#include <utility>
#include <cmath>

using namespace std;

#define _è°ƒè¯•

typedef int åŸºå› ;
typedef vector<åŸºå› > åŸºå› é“¾;
typedef vector<åŸºå› é“¾> ä»£;
typedef double é€‚åº¦;

#define å°ä¸ªä½“ å°åŸºé“¾
#define å°ç§ç¾¤ å°ä»£
#define ğ›‘ 3.14159265359

typedef int å·å‹;
typedef double é”®å‹;
typedef vector<é”®å‹> åˆ—å‹;

class å‡½æ•°æœ€å¤§å€¼
{
public:
    // è¯¾æœ¬445é¡µç®—æ³•
    /*
    1. é€ åˆä»£, éšæœºé€ ä¹‹
    2. é€‚åº”åŠ›(é€‚åº¦)ä¸ºå‡½æ•°å€¼
    3. é€‰ç§:
    4. æ‚äº¤å˜å¼‚
    5. åœ
    ç¡®å®šæ¯ä»£ä¸ªä½“æ•°, å¯èŠ‚çœé‡å¤åˆ†é…é‡Šæ”¾å†…å­˜æ—¶é—´, æ”¹è¿›æ€§èƒ½.
    */

    void é€ä»£æ¼”åŒ–()
    {
        int ä»£æ•° = 0;

        é€ ä»£(çˆ¶ä»£); // åˆä»£
        cout << å°ç§ç¾¤(çˆ¶ä»£, "åˆä»£") << endl;
        do
        {
            ç®—ä»£é€‚åº¦(çˆ¶ä»£, ä»£é€‚åº¦, å½’ä¸€é€‚åº¦, ç´¯ç§¯é€‚åº¦);
            é€‰ç§(çˆ¶ä»£, ä»£é€‚åº¦, å½’ä¸€é€‚åº¦, ç´¯ç§¯é€‚åº¦, ç§);
            ç¾¤äº¤(ç§, å­ä»£);
            ç¾¤å˜(å­ä»£);
            cout << å°ç§ç¾¤(å­ä»£, "å­ä»£") << endl;

            çˆ¶ä»£ = å­ä»£;
            ä»£æ•°++;
        } while (!åœ(ä»£é€‚åº¦, pæ­¢æ¼”é€‚åº¦, ä»£æ•°, pæ­¢æ¼”ä»£æ•°));
    }

    // è¯¾æœ¬445é¡µç¬¬10.2.2èŠ‚
    /* æ±‚ f(x) = sin(ğ›‘x/256) åœ¨åŒºé—´[0,255]ä¸Šä¹‹æœ€å¤§å€¼
    x ä¸ºæ•´æ•°.
    1. åŸºå› é“¾: 8ä½æ•´æ•°, æ¯ä½å³ä¸€åŸºå› 
    2. é€ åˆä»£, éšæœºé€ ä¹‹
    3. é€‚åº”åŠ›(é€‚åº¦)ä¸ºå‡½æ•°å€¼
    4. é€‰ç§:
    5. æ‚äº¤å˜å¼‚
    6. åœ
    */
    void é€ ä»£(ä»£ &åˆ) const
    {
        int ä¸ª = pæ¯ä»£ä¸ªæ•°, ä¸ªå€¼;
        uniform_int_distribution<int> é€ ä¸ªä½“(0, 255);

        while (--ä¸ª >= 0)
        {
            åŸºå› é“¾ ä¸ªä½“(påŸºå› é“¾é•¿, 0);
            int åŸºä½ = påŸºå› é“¾é•¿;
            ä¸ªå€¼ = é€ ä¸ªä½“(éšæœºæº);
            // cout << "ä¸ªå€¼:" << hex << ä¸ªå€¼ << endl;
            while (--åŸºä½ >= 0)
            {
                if (ä¸ªå€¼ & 0x80)
                    ä¸ªä½“[påŸºå› é“¾é•¿ - 1 - åŸºä½] = 1;
                else
                    ä¸ªä½“[påŸºå› é“¾é•¿ - 1 - åŸºä½] = 0;

                ä¸ªå€¼ <<= 1;
            }

            åˆ[ä¸ª] = ä¸ªä½“;
        }
#ifdef _è°ƒè¯•
        cout << "é€ ä»£:\n"
             << å°ç§ç¾¤(åˆ) << endl;
#endif
    }

    void ç®—ä¸ªé€‚åº¦(const åŸºå› é“¾ &ä¸ªä½“,
                  int &åŸºåº¦, // åŸºå› åº¦é‡, ä¸åŒåº”ç”¨ä¸åŒåº¦é‡
                  é€‚åº¦ &åº¦) const
    {
        int ä½ = påŸºå› é“¾é•¿;
        åŸºåº¦ = 0;
        while (--ä½ >= 0)
        {
            åŸºåº¦ += (ä¸ªä½“[påŸºå› é“¾é•¿ - 1 - ä½] << ä½);
        }

        åº¦ = sin(ğ›‘ * åŸºåº¦ / 256);
#ifdef _è°ƒè¯•
        cout << "ç®—ä¸ªé€‚åº¦:\n"
             << "åŸºåº¦ = " << åŸºåº¦ << ", é€‚åº¦ = " << åº¦ << endl;
#endif
    }

    void ç®—ä»£é€‚åº¦(const ä»£ &æŸä»£, vector<é€‚åº¦> &ä»£é€‚åº¦, vector<é€‚åº¦> &å½’ä¸€é€‚åº¦, vector<é€‚åº¦> &ç´¯ç§¯é€‚åº¦) const
    {
        vector<int> ä»£åŸºåº¦(pæ¯ä»£ä¸ªæ•°, 0);

        for (int ä¸ª = 0; ä¸ª < pæ¯ä»£ä¸ªæ•°; ä¸ª++)
        {
            ç®—ä¸ªé€‚åº¦(æŸä»£[ä¸ª], ä»£åŸºåº¦[ä¸ª], ä»£é€‚åº¦[ä¸ª]);
        }

        é€‚åº¦ ä»£é€‚åº¦å’Œ = accumulate(ä»£é€‚åº¦.begin(), ä»£é€‚åº¦.end(), 0.0);
        transform(ä»£é€‚åº¦.begin(), ä»£é€‚åº¦.end(), å½’ä¸€é€‚åº¦.begin(),
                  [=](é€‚åº¦ å…ƒ)
                  { return å…ƒ / ä»£é€‚åº¦å’Œ; });
        partial_sum(å½’ä¸€é€‚åº¦.begin(), å½’ä¸€é€‚åº¦.end(), ç´¯ç§¯é€‚åº¦.begin());

#ifdef _è°ƒè¯•
        cout << å°åˆ—<é€‚åº¦>(ä»£é€‚åº¦) << endl;
        cout << "ä»£é€‚åº¦å’Œ:" << ä»£é€‚åº¦å’Œ << endl;

        cout << left << setfill(' ') << setw(20) << "ä¸ªä½“" << setw(8) << "x" << setw(13) << "é€‚åº¦" << setw(12) << "å½’ä¸€é€‚åº¦" << setw(13) << "ç´¯ç§¯é€‚åº¦" << endl;

        for (int ä¸ª = 0; ä¸ª < pæ¯ä»£ä¸ªæ•°; ä¸ª++)
        {
            cout << left << setfill(' ') << setw(20) << å°ä¸ªä½“(æŸä»£[ä¸ª]) << setw(6) << ä»£åŸºåº¦[ä¸ª] << setw(10) << setprecision(3) << ä»£é€‚åº¦[ä¸ª] << setw(10) << setprecision(3) << å½’ä¸€é€‚åº¦[ä¸ª] << setw(10) << setprecision(3) << ç´¯ç§¯é€‚åº¦[ä¸ª] << endl;
        }
#endif //  _è°ƒè¯•
    }

    void é€‰ç§(const ä»£ &æŸä»£, const vector<é€‚åº¦> &ä»£é€‚åº¦, const vector<é€‚åº¦> &å½’ä¸€é€‚åº¦, const vector<é€‚åº¦> &ç´¯ç§¯é€‚åº¦, ä»£ &ç§) const
    {
        int ä¸ª = pæ¯ä»£ä¸ªæ•°;
        uniform_real_distribution<> æŒ‘ç§(0, 1);

        // è½¬è½®ç›˜é€‰ç§: è‰¯ç§å¯ç”¨å¤šæ¬¡ä¸”è¢«é€‰ä¸­æ¦‚ç‡å¤§
        while (--ä¸ª >= 0)
        {
            ç§[ä¸ª] = æŸä»£[æŠ˜åŠå¯»(ç´¯ç§¯é€‚åº¦, æŒ‘ç§(éšæœºæº))];
        }
#ifdef _è°ƒè¯•
        cout << å°ç§ç¾¤(ç§) << endl;
#endif
    }

    void æ‚äº¤(const åŸºå› é“¾ &çˆ¶, const åŸºå› é“¾ &æ¯, åŸºå› é“¾ &å­, åŸºå› é“¾ &å¥³) const
    {
        // å®šäº¤æ¢ç‰‡æ®µ
        å·å‹ èµ·, æ­¢;
        uniform_int_distribution<> å®šç‚¹(0, çˆ¶.size() - 1);
        bernoulli_distribution æ¢(pæ‚äº¤æ¦‚ç‡);
        èµ· = å®šç‚¹(éšæœºæº), æ­¢ = å®šç‚¹(éšæœºæº);
        å­ = çˆ¶, å¥³ = æ¯;

        if (æ¢(éšæœºæº))
        {
            if (èµ· <= æ­¢)
            {
                swap_ranges(å­.begin() + èµ·, å­.begin() + æ­¢ + 1, å¥³.begin() + èµ·);
            }
            else
            {
                swap_ranges(å­.begin(), å­.begin() + æ­¢, å¥³.begin());
                swap_ranges(å­.begin() + èµ·, å­.end(), å¥³.begin() + èµ·);
            }
        }
#ifdef _è°ƒè¯•
        cout << å°æ¢(çˆ¶, èµ·, æ­¢, "çˆ¶") << endl;
        cout << å°æ¢(æ¯, èµ·, æ­¢, "æ¯") << endl;
        cout << å°æ¢(å­, èµ·, æ­¢, "å­") << endl;
        cout << å°æ¢(å¥³, èµ·, æ­¢, "å¥³") << endl;
#endif // _è°ƒè¯•
    }

    void ç¾¤äº¤(ä»£ &ç¥–, ä»£ &å) const
    {
        shuffle(ç¥–.begin(), ç¥–.end(), éšæœºæº); // éšæœºé…å¯¹

        for (å·å‹ å¯¹ = 0; å¯¹ < pæ¯ä»£ä¸ªæ•° / 2; å¯¹++)
        {
            æ‚äº¤(ç¥–[2 * å¯¹], ç¥–[2 * å¯¹ + 1], å[2 * å¯¹], å[2 * å¯¹ + 1]);
        }
    }

    void å˜å¼‚(åŸºå› é“¾ &æŸ) const
    {
        bernoulli_distribution å˜(på˜å¼‚æ¦‚ç‡);
        åŸºå› é“¾ åŸ = æŸ;
        å·å‹ å· = 0;

        for (å· = 0; å· < påŸºå› é“¾é•¿; å·++)
            if (å˜(éšæœºæº))
                æŸ[å·] = (æŸ[å·] + 1) % 2;

#ifdef _è°ƒè¯•
        cout << å°ä¸ªä½“(åŸ, "åŸ") << endl;
        cout << å°ä¸ªä½“(æŸ, "å˜") << endl;
#endif // _è°ƒè¯•
    }

    void ç¾¤å˜(ä»£ &æŸ) const
    {
        for (å·å‹ ä¸ª = 0; ä¸ª < pæ¯ä»£ä¸ªæ•°; ä¸ª++)
        {
            å˜å¼‚(æŸ[ä¸ª]);
        }
    }

    å·å‹ æŠ˜åŠå¯»(const åˆ—å‹ &æ•°, const é”®å‹ &æ ‡) const
    {
        å·å‹ å·¦, ä¸­, å³, ä½ = -1;
        å·¦ = 0;
        å³ = æ•°.size() - 1;

        while (å·¦ <= å³ && ä½ == -1)
        {
            ä¸­ = (å·¦ + å³) / 2;

            if (æ ‡ == æ•°[ä¸­])
                return ä¸­;
            else if (æ ‡ < æ•°[ä¸­])
                å³ = ä¸­ - 1;
            else
                å·¦ = ä¸­ + 1;
        }

        if (æ ‡ <= æ•°[ä¸­])
            ä½ = ä¸­;
        else
            ä½ = ä¸­ + 1;

        return ä½;
    }

    bool åœ(vector<é€‚åº¦> &ä»£é€‚åº¦, const é€‚åº¦ &æ­¢é€‚åº¦, const int ä»£æ•°, const int &æ­¢ä»£æ•°) const
    {
        if (ä»£æ•° >= æ­¢ä»£æ•°)
        {
            cout << "ä»£æ•°å·²è¿‡!" << endl;
            return true;
        }

        // å–2/8è¶…è¿‡æ­¢é€‚åº¦
        sort(ä»£é€‚åº¦.begin(), ä»£é€‚åº¦.end());
        if (ä»£é€‚åº¦[ä»£é€‚åº¦.size() - 2] >= æ­¢é€‚åº¦)
        {
            cout << "ç¬¬" << ä»£æ•° << "ä»£å³æˆ";
            cout << å°ä»£(å­ä»£, "æ»¡æ„çš„åä»£") << endl;
            return true;
        }

        return false;
    }

public:
    static default_random_engine éšæœºæº;

    // _æ¼”åŒ–é…ç½®
    int pæ¯ä»£ä¸ªæ•°; // å‡è®¾æ¯ä»£ä¸ªä½“æ•°ä¸€æ ·
    int påŸºå› é“¾é•¿;
    é€‚åº¦ pæ­¢æ¼”é€‚åº¦;
    int pæ­¢æ¼”ä»£æ•°;
    double pæ‚äº¤æ¦‚ç‡;
    double på˜å¼‚æ¦‚ç‡;

    // ç§ç¾¤
    ä»£ çˆ¶ä»£;
    ä»£ ç§;
    ä»£ é…ä»£;
    ä»£ å­ä»£;

    // è¯„ä¼°
    vector<é€‚åº¦> ä»£é€‚åº¦, å½’ä¸€é€‚åº¦, ç´¯ç§¯é€‚åº¦;

    å‡½æ•°æœ€å¤§å€¼()
    {
        éšæœºæº.seed(314);

        // _æ¼”åŒ–é…ç½®
        pæ¯ä»£ä¸ªæ•° = 8;
        påŸºå› é“¾é•¿ = 8;
        pæ­¢æ¼”é€‚åº¦ = 0.99;
        pæ­¢æ¼”ä»£æ•° = 200;
        pæ‚äº¤æ¦‚ç‡ = 0.8;
        på˜å¼‚æ¦‚ç‡ = 0.001;

        // ç§ç¾¤
        çˆ¶ä»£ = ç§ = å­ä»£ = é…ä»£ = ä»£(pæ¯ä»£ä¸ªæ•°, åŸºå› é“¾(påŸºå› é“¾é•¿, 0));

        // è¯„ä¼°
        ä»£é€‚åº¦ = å½’ä¸€é€‚åº¦ = ç´¯ç§¯é€‚åº¦ = vector<é€‚åº¦>(pæ¯ä»£ä¸ªæ•°, 0);
    };

    string å°åŸºå› (const åŸºå›  &åŸº) const
    {
        stringstream ss;
        ss << åŸº;
        return ss.str();
    }

    string å°åŸºé“¾(const åŸºå› é“¾ &é“¾, const string &å•¥ = "") const
    {
        stringstream ss;
        ss << å•¥ << "(";
        for (int å· = 0; å· < é“¾.size(); å·++)
        {
            ss << å°åŸºå› (é“¾[å·]) << (å· == é“¾.size() - 1 ? "" : ",");
        }
        ss << ")";
        return ss.str();
    }

    string å°æ¢(const åŸºå› é“¾ &é“¾, const int èµ·, const int æ­¢, const string &å•¥ = "") const
    {
        stringstream ss;
        ss << å•¥;
        if (èµ· <= æ­¢)
        {
            ss << èµ· << "->" << æ­¢ << "(";
            for (å·å‹ å· = 0; å· < påŸºå› é“¾é•¿; å·++)
            {
                if (å· == èµ·)
                    ss << "|";
                ss << é“¾[å·];
                if (å· == æ­¢)
                    ss << "||";
            }
        }
        else
        {
            ss << 0 << "->" << æ­¢ << "|" << èµ· << "->" << påŸºå› é“¾é•¿ - 1 << "(";
            for (å·å‹ å· = 0; å· < påŸºå› é“¾é•¿; å·++)
            {
                if (å· == æ­¢)
                    ss << "||";

                if (å· == èµ·)
                    ss << "|";

                ss << é“¾[å·];
            }
        }
        ss << ")";
        return ss.str();
    }

    string å°ä»£(const ä»£ &æŸä»£, const string &å•¥ = "") const
    {
        stringstream ss;
        ss << å•¥ << endl;
        ss << "---------å…±" << æŸä»£.size() << "ä¸ª---------" << endl;
        int ä¸ª = 1;
        for (auto ä¸ªä½“ : æŸä»£)
            ss << setw(4) << ä¸ª++ << ":" << å°ä¸ªä½“(ä¸ªä½“) << endl;
        return ss.str();
    }

    template <typename T>
    string å°åˆ—(const vector<T> &åˆ—) const
    {
        stringstream ss;
        ss << "[";
        for (int å· = 0; å· < åˆ—.size(); å·++)
        {
            ss << å· << ":" << åˆ—[å·] << (å· == åˆ—.size() - 1 ? "" : ",");
        }
        ss << "]";
        return ss.str();
    }
};

default_random_engine å‡½æ•°æœ€å¤§å€¼::éšæœºæº = default_random_engine();

int main(int argc, char const *argv[])
{
    å‡½æ•°æœ€å¤§å€¼ ä¼ 1;
    ä¼ 1.é€ä»£æ¼”åŒ–();

    return 0;
}
